Index: app/src/main/java/com/example/frontend/ui/clothes/ClothesFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.frontend.ui.clothes;\r\n\r\nimport android.app.Activity;\r\nimport android.content.Intent;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.AdapterView;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.GridLayout;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.Spinner;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.constraintlayout.widget.ConstraintLayout;\r\nimport androidx.constraintlayout.widget.ConstraintSet;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.test.espresso.idling.CountingIdlingResource;\r\n\r\nimport com.example.frontend.AddClothesActivity;\r\nimport com.example.frontend.MainActivity;\r\nimport com.example.frontend.R;\r\nimport com.example.frontend.EditClothesActivity;\r\nimport com.example.frontend.User;\r\n\r\nimport org.jetbrains.annotations.NotNull;\r\n\r\nimport java.io.IOException;\r\nimport java.util.Objects;\r\n\r\nimport okhttp3.Call;\r\nimport okhttp3.Callback;\r\nimport okhttp3.OkHttpClient;\r\nimport okhttp3.Request;\r\nimport okhttp3.Response;\r\n\r\npublic class ClothesFragment extends Fragment implements View.OnClickListener, AdapterView.OnItemSelectedListener {\r\n    private static final String TAG =\"ClothesFragment\" ;\r\n    private static final String EMPTY_STRING = \"\";\r\n\r\n    private User user;\r\n    private String path;\r\n    private Bitmap bitmap;\r\n    private String clothesId = EMPTY_STRING;\r\n\r\n    private ImageButton buttonAdd;\r\n    private GridLayout clothesLayout;\r\n    private ImageView image;\r\n    private Spinner spinner;\r\n    private ConstraintLayout clothes;\r\n    private int selectedId;\r\n\r\n    private final int ADD = 1;\r\n    private final int EDIT = 2;\r\n\r\n    static View root;\r\n    static CountingIdlingResource idlingResource = new CountingIdlingResource(\"send_add_clothes_request\");\r\n\r\n    public View onCreateView(@NonNull LayoutInflater inflater,\r\n                             ViewGroup container, Bundle savedInstanceState) {\r\n        root = inflater.inflate(R.layout.fragment_clothes, container, false);\r\n\r\n        buttonAdd = root.findViewById(R.id.btn_clothes_add);\r\n        buttonAdd.setOnClickListener(this);\r\n        clothesLayout = root.findViewById(R.id.gl_clothes);\r\n\r\n        return root;\r\n    }\r\n\r\n    public void setAdapter(int textArrayResId, @NotNull Spinner spinner) {\r\n        // Create an ArrayAdapter using the string array and a default spinner layout\r\n        ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(ClothesFragment.this.getContext(),\r\n                textArrayResId, android.R.layout.simple_spinner_item);\r\n\r\n        // Specify the layout to use when the list of choices appears\r\n        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\r\n        // Apply the adapter to the spinner\r\n        spinner.setAdapter(adapter);\r\n    }\r\n\r\n    @Override\r\n    public void onClick(View view) {\r\n        switch (view.getId()){\r\n            case R.id.btn_clothes_add:\r\n                idlingResource.increment();\r\n                user = MainActivity.getUser();\r\n                Intent addClothesIntent = new Intent(ClothesFragment.this.getContext(), AddClothesActivity.class);\r\n                addClothesIntent.putExtra(\"user\", user);\r\n                startActivityForResult(addClothesIntent, ADD);\r\n                idlingResource.decrement();\r\n                break;\r\n\r\n            default:\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\r\n        selectedId = parent.getId();\r\n\r\n        if (parent.getSelectedItem().toString().equals(\"Edit\")) {\r\n\r\n            while (clothesId.equals(EMPTY_STRING)) {\r\n                Log.d(TAG, \"waiting for clothes id\");\r\n            }\r\n\r\n            Intent editClothesIntent = new Intent(ClothesFragment.this.getContext(), EditClothesActivity.class);\r\n            editClothesIntent.putExtra(\"user\", user);\r\n            editClothesIntent.putExtra(\"path\", path);\r\n            editClothesIntent.putExtra(\"clothesId\", clothesId);\r\n            startActivityForResult(editClothesIntent, EDIT);\r\n        }\r\n\r\n        else if (parent.getSelectedItem().toString().equals(\"Delete\")) {\r\n\r\n            while (clothesId.equals(EMPTY_STRING)) {\r\n                Log.d(TAG, \"waiting for clothes id\");\r\n            }\r\n\r\n            deleteClothesFromCloset(selectedId);\r\n//            deleteImageFromServer();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n\r\n        if (resultCode == Activity.RESULT_OK && requestCode == ADD) {\r\n            // here you can retrieve your bundle data.\r\n            path = data.getStringExtra(\"path\");\r\n            clothesId = data.getStringExtra(\"clothesId\");\r\n            bitmap = BitmapFactory.decodeFile(path);\r\n\r\n            addClothesToCloset();\r\n        }\r\n\r\n        else if (resultCode == Activity.RESULT_OK && requestCode == EDIT) {\r\n            path = data.getStringExtra(\"path\");\r\n            bitmap = BitmapFactory.decodeFile(path);\r\n            editClothesInCloset(selectedId);\r\n        }\r\n    }\r\n\r\n    private void addClothesToCloset() {\r\n        image = new ImageView(getContext());\r\n        image.setId(View.generateViewId());\r\n        ConstraintLayout.LayoutParams imageParams = new ConstraintLayout.LayoutParams(0, ViewGroup.LayoutParams.WRAP_CONTENT);\r\n        imageParams.width = 300;\r\n        imageParams.height = 300;\r\n        image.setLayoutParams(imageParams);\r\n        image.setImageBitmap(bitmap);\r\n\r\n        spinner = new Spinner(getContext());\r\n        spinner.setId(View.generateViewId());\r\n        ConstraintLayout.LayoutParams spinnerParams = new ConstraintLayout.LayoutParams(0, ViewGroup.LayoutParams.WRAP_CONTENT);\r\n        spinnerParams.width = 90;\r\n        spinnerParams.height = 90;\r\n        spinner.setLayoutParams(spinnerParams);\r\n        spinner.setBackgroundResource(R.drawable.dots);\r\n        setAdapter(R.array.edit_delete_array, spinner);\r\n        spinner.setOnItemSelectedListener(this);\r\n\r\n        clothes = new ConstraintLayout(getContext());\r\n        clothes.setId(View.generateViewId());\r\n        clothes.addView(image);\r\n        clothes.addView(spinner);\r\n        ConstraintSet constraint = new ConstraintSet();\r\n        constraint.clone(clothes);\r\n        constraint.connect(spinner.getId(), ConstraintSet.RIGHT, image.getId(), ConstraintSet.RIGHT);\r\n        constraint.applyTo(clothes);\r\n\r\n        clothesLayout.addView(clothes);\r\n    }\r\n\r\n    private void editClothesInCloset(int selectedId) {\r\n        image = root.findViewById(selectedId - 1);\r\n        while (bitmap == null) {\r\n            Log.d(TAG, \"waiting for bitmap\");\r\n        }\r\n        image.setImageBitmap(bitmap);\r\n    }\r\n\r\n    private void deleteClothesFromCloset(int selectedId) {\r\n        clothes = root.findViewById(selectedId + 1);\r\n        clothesLayout.removeView(clothes);\r\n    }\r\n\r\n    private void deleteImageFromServer() {\r\n        OkHttpClient client = new OkHttpClient();\r\n        Request request = new Request.Builder()\r\n                .url(\"http://closet-cpen321.westus.cloudapp.azure.com/api/images/\" + user.getUserId() + \"/\" + clothesId)\r\n                .addHeader(\"Authorization\", \"Bearer\" + user.getUserToken())\r\n                .delete()\r\n                .build();\r\n        Call call = client.newCall(request);\r\n        call.enqueue(new Callback() {\r\n            @Override\r\n            public void onFailure(@NotNull Call call, @NotNull IOException e) {\r\n                e.printStackTrace();\r\n            }\r\n\r\n            @Override\r\n            public void onResponse(@NotNull Call call, @NotNull Response response) throws IOException {\r\n                String responseStr = Objects.requireNonNull(response.body().string());\r\n                Log.d(TAG, \"Successfully delete image from server: \" + responseStr);\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public void onNothingSelected(AdapterView<?> parent) {\r\n        Log.d(TAG, \"nothing is selected\");\r\n    }\r\n\r\n    public static CountingIdlingResource getRegisterIdlingResourceInTest() {\r\n        return idlingResource;\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/frontend/ui/clothes/ClothesFragment.java	(revision 9cbc60e8f7ecbee17c2cf7b3bc84512af8dbd22d)
+++ app/src/main/java/com/example/frontend/ui/clothes/ClothesFragment.java	(date 1605506782805)
@@ -59,12 +59,13 @@
     private final int EDIT = 2;
 
     static View root;
-    static CountingIdlingResource idlingResource = new CountingIdlingResource("send_add_clothes_request");
 
     public View onCreateView(@NonNull LayoutInflater inflater,
                              ViewGroup container, Bundle savedInstanceState) {
         root = inflater.inflate(R.layout.fragment_clothes, container, false);
 
+        user = MainActivity.getUser();
+
         buttonAdd = root.findViewById(R.id.btn_clothes_add);
         buttonAdd.setOnClickListener(this);
         clothesLayout = root.findViewById(R.id.gl_clothes);
@@ -87,12 +88,8 @@
     public void onClick(View view) {
         switch (view.getId()){
             case R.id.btn_clothes_add:
-                idlingResource.increment();
-                user = MainActivity.getUser();
                 Intent addClothesIntent = new Intent(ClothesFragment.this.getContext(), AddClothesActivity.class);
-                addClothesIntent.putExtra("user", user);
                 startActivityForResult(addClothesIntent, ADD);
-                idlingResource.decrement();
                 break;
 
             default:
@@ -217,8 +214,4 @@
     public void onNothingSelected(AdapterView<?> parent) {
         Log.d(TAG, "nothing is selected");
     }
-
-    public static CountingIdlingResource getRegisterIdlingResourceInTest() {
-        return idlingResource;
-    }
 }
\ No newline at end of file
